<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EasyDoc 2.0 - Shape-Based Editor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f0f0f0;
            max-width: 100%;
            box-sizing: border-box;
        }

        h1 {
            text-align: center;
            font-size: 1.5em;
        }

        .shape {
            background-color: #d3d3d3; /* Gray background for shapes */
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            width: 100%;
            box-sizing: border-box;
            position: relative;
        }

        .shape-buttons {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
        }

        .shape-buttons button {
            padding: 5px 10px;
            font-size: 0.8em;
            width: auto;
        }

        textarea {
            width: 100%;
            min-height: 80px;
            resize: vertical;
            border: none;
            background: transparent;
            font-size: 1em;
        }

        #preview-shape pre {
            margin: 0;
            white-space: pre-wrap;
            background-color: #e0e0e0; /* Lighter gray for preview */
            padding: 10px;
            border-radius: 5px;
        }

        button {
            padding: 10px 20px;
            margin: 5px 0;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            width: 100%;
            font-size: 1em;
        }

        button:hover {
            background-color: #45a049;
        }

        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        #status {
            color: #333;
            word-wrap: break-word;
        }

        /* Mobile Responsiveness */
        @media (max-width: 600px) {
            h1 {
                font-size: 1.2em;
            }
            .shape {
                padding: 5px;
                margin: 5px 0;
            }
            .shape-buttons {
                top: 5px;
                right: 5px;
                flex-direction: column;
                gap: 2px;
            }
            .shape-buttons button {
                padding: 3px 6px;
                font-size: 0.7em;
            }
            textarea {
                min-height: 60px;
                font-size: 0.9em;
            }
            button {
                padding: 8px;
                font-size: 0.9em;
            }
            select, input[type="text"] {
                width: 100%;
                padding: 5px;
                font-size: 0.9em;
                margin: 5px 0;
            }
        }
    </style>
</head>
<body>
    <h1>EasyDoc 2.0 - Build Your Document</h1>

    <!-- 1. Select Template -->
    <label for="template">Select Template:</label>
    <select id="template" onchange="updatePreview()">
        <option value="Header-Content-Footer">Header-Content-Footer</option>
        <option value="Title-Content">Title-Content</option>
    </select>

    <!-- 2. Text Boxes -->
    <div id="sections">
        <div class="shape" id="header-shape">
            <label>Header/Title:</label>
            <textarea id="header">Sample Header\nEdit me!</textarea>
            <div class="shape-buttons">
                <button onclick="moveSection('header', 'up')" id="header-up">Move Up</button>
                <button onclick="moveSection('header', 'down')" id="header-down">Move Down</button>
            </div>
        </div>

        <div class="shape" id="content-shape">
            <label>Content:</label>
            <textarea id="content">This is the main content.\nWrite your document here.</textarea>
            <div class="shape-buttons">
                <button onclick="moveSection('content', 'up')" id="content-up">Move Up</button>
                <button onclick="moveSection('content', 'down')" id="content-down">Move Down</button>
            </div>
        </div>

        <div class="shape" id="footer-shape">
            <label>Footer:</label>
            <textarea id="footer">Footer - Add notes or credits.</textarea>
            <div class="shape-buttons">
                <button onclick="moveSection('footer', 'up')" id="footer-up">Move Up</button>
                <button onclick="moveSection('footer', 'down')" id="footer-down">Move Down</button>
            </div>
        </div>
    </div>

    <!-- 3. Add Section -->
    <button onclick="addSection()">Add Section</button>

    <!-- 4. Refresh Preview -->
    <button onclick="updatePreview()">Refresh Preview</button>

    <!-- 5. Preview -->
    <div class="shape" id="preview-shape">
        <label>Preview:</label>
        <pre id="preview">Preview will appear here...</pre>
    </div>

    <!-- 6. Save Content -->
    <button onclick="saveContent()">Save Content</button>

    <!-- 7. Load File -->
    <button onclick="loadFile()">Load File into Content</button>
    <input type="file" id="fileInput" style="display:none;" accept=".txt" onchange="handleFileSelect(event)">

    <!-- 8. Generate PDF -->
    <button onclick="generatePDF()">Generate PDF</button>

    <!-- 9. Output File Name -->
    <label for="filename">Output Filename:</label>
    <input type="text" id="filename" value="output.pdf">

    <p id="status"></p>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        let sectionOrder = ['header', 'content', 'footer']; // Default order
        let sectionContent = {
            'header': document.getElementById('header'),
            'content': document.getElementById('content'),
            'footer': document.getElementById('footer')
        };

        function updateSectionOrder() {
            const sectionsDiv = document.getElementById('sections');
            const sectionElements = {};
            sectionOrder.forEach(section => {
                sectionElements[section] = document.getElementById(`${section}-shape`);
            });

            // Remove all sections and re-append in the new order
            sectionsDiv.innerHTML = '';
            sectionOrder.forEach(section => {
                sectionsDiv.appendChild(sectionElements[section]);
            });

            // Update button states (disable Move Up for first, Move Down for last)
            sectionOrder.forEach((section, index) => {
                document.getElementById(`${section}-up`).disabled = index === 0;
                document.getElementById(`${section}-down`).disabled = index === sectionOrder.length - 1;
            });

            updatePreview();
        }

        function moveSection(section, direction) {
            const index = sectionOrder.indexOf(section);
            if (direction === 'up' && index > 0) {
                [sectionOrder[index], sectionOrder[index - 1]] = [sectionOrder[index - 1], sectionOrder[index]];
            } else if (direction === 'down' && index < sectionOrder.length - 1) {
                [sectionOrder[index], sectionOrder[index + 1]] = [sectionOrder[index + 1], sectionOrder[index]];
            }
            updateSectionOrder();
        }

        function addSection() {
            const sectionName = prompt('Enter a name for the new section (e.g., Section1):');
            if (sectionName && !sectionOrder.includes(sectionName.toLowerCase())) {
                const newSectionId = sectionName.toLowerCase();
                const newTextarea = document.createElement('textarea');
                newTextarea.id = newSectionId;
                newTextarea.value = `New ${sectionName} content here...`;

                const newShape = document.createElement('div');
                newShape.className = 'shape';
                newShape.id = `${newSectionId}-shape`;
                newShape.innerHTML = `<label>${sectionName}:</label>${newTextarea.outerHTML}<div class="shape-buttons"><button onclick="moveSection('${newSectionId}', 'up')" id="${newSectionId}-up">Move Up</button><button onclick="moveSection('${newSectionId}', 'down')" id="${newSectionId}-down">Move Down</button></div>`;

                sectionContent[newSectionId] = newTextarea;
                sectionOrder.push(newSectionId);
                document.getElementById('sections').appendChild(newShape);
                updateSectionOrder();
                document.getElementById('status').textContent = `Added new section: ${sectionName}`;
            } else if (sectionOrder.includes(sectionName.toLowerCase())) {
                document.getElementById('status').textContent = 'Section name already exists!';
            } else {
                document.getElementById('status').textContent = 'Section not added. Please enter a name.';
            }
        }

        function updatePreview() {
            const header = document.getElementById('header').value;
            const content = document.getElementById('content').value;
            const footer = document.getElementById('footer').value;
            const template = document.getElementById('template').value;

            const sections = {
                'header': template === 'Title-Content' ? `Title:\n${header}` : `Header:\n${header}`,
                'content': `Content:\n====\n${content}\n====`,
                'footer': `Footer:\n${footer}`
            };

            // Include dynamic sections
            for (const section in sectionContent) {
                if (!['header', 'content', 'footer'].includes(section)) {
                    sections[section] = `${section.charAt(0).toUpperCase() + section.slice(1)}:\n${sectionContent[section].value}`;
                }
            }

            let preview = '';
            sectionOrder.forEach((section, index) => {
                if (template === 'Title-Content' && section === 'footer') return; // Skip footer for Title-Content
                if (preview !== '') preview += '\n\n';
                preview += sections[section];
            });
            document.getElementById('preview').textContent = preview;
        }

        function generatePDF() {
            const header = document.getElementById('header').value;
            const content = document.getElementById('content').value;
            const footer = document.getElementById('footer').value;
            const template = document.getElementById('template').value;
            const filename = document.getElementById('filename').value || 'output.pdf';

            const sections = {
                'header': template === 'Title-Content' ? `Title:\n${header}` : `Header:\n${header}`,
                'content': `Content:\n====\n${content}\n====`,
                'footer': `Footer:\n${footer}`
            };

            // Include dynamic sections
            for (const section in sectionContent) {
                if (!['header', 'content', 'footer'].includes(section)) {
                    sections[section] = `${section.charAt(0).toUpperCase() + section.slice(1)}:\n${sectionContent[section].value}`;
                }
            }

            let pdfContent = '';
            sectionOrder.forEach((section, index) => {
                if (template === 'Title-Content' && section === 'footer') return; // Skip footer for Title-Content
                if (pdfContent !== '') pdfContent += '\n\n';
                pdfContent += sections[section];
            });

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.text(pdfContent, 10, 10);
            doc.save(filename);

            document.getElementById('status').textContent = `PDF generated and downloaded as ${filename}`;
        }

        function saveContent() {
            const header = document.getElementById('header').value;
            const content = document.getElementById('content').value;
            const footer = document.getElementById('footer').value;
            const template = document.getElementById('template').value;
            // Use distinct section markers and include template and order
            let fullContent = `===TEMPLATE:${template}===\n===SECTION:ORDER===\n${sectionOrder.join(',')}\n`;
            sectionOrder.forEach(section => {
                fullContent += `\n===SECTION:${section.toUpperCase()}===\n${sectionContent[section].value}`;
            });
            const blob = new Blob([fullContent], { type: 'text/plain' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'easydoc_save.txt';
            link.click();
            document.getElementById('status').textContent = 'Content saved as easydoc_save.txt';
        }

        function loadFile() {
            document.getElementById('fileInput').click();
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const content = e.target.result;
                    // Parse the saved content using distinct section markers
                    let savedTemplate = 'Header-Content-Footer'; // Default template
                    let savedOrder = ['header', 'content', 'footer']; // Default order

                    // Extract the template
                    if (content.includes('===TEMPLATE:')) {
                        const templateStart = content.indexOf('===TEMPLATE:') + '===TEMPLATE:'.length;
                        const templateEnd = content.indexOf('===', templateStart);
                        if (templateEnd !== -1) {
                            savedTemplate = content.substring(templateStart, templateEnd).trim();
                        }
                    }

                    // Extract the section order
                    if (content.includes('===SECTION:ORDER===')) {
                        const orderStart = content.indexOf('===SECTION:ORDER===') + '===SECTION:ORDER==='.length;
                        const orderEnd = content.indexOf('===', orderStart);
                        if (orderEnd !== -1) {
                            savedOrder = content.substring(orderStart, orderEnd).trim().split(',').map(item => item.trim());
                        }
                    }

                    // Clear existing dynamic sections
                    for (const section in sectionContent) {
                        if (!['header', 'content', 'footer'].includes(section)) {
                            delete sectionContent[section];
                            const shape = document.getElementById(`${section}-shape`);
                            if (shape) shape.remove();
                        }
                    }

                    // Extract and populate sections
                    savedOrder.forEach(section => {
                        if (content.includes(`===SECTION:${section.toUpperCase()}===`)) {
                            const sectionIndex = content.indexOf(`===SECTION:${section.toUpperCase()}===`) + `===SECTION:${section.toUpperCase()}===`.length;
                            const nextSectionStart = content.indexOf(`===SECTION:`, sectionIndex);
                            let sectionContentText = nextSectionStart !== -1 ? content.substring(sectionIndex, nextSectionStart).trim() : content.substring(sectionIndex).trim();
                            if (sectionContent[section]) {
                                sectionContent[section].value = sectionContentText;
                            } else {
                                const newTextarea = document.createElement('textarea');
                                newTextarea.id = section;
                                newTextarea.value = sectionContentText;
                                sectionContent[section] = newTextarea;

                                const newShape = document.createElement('div');
                                newShape.className = 'shape';
                                newShape.id = `${section}-shape`;
                                newShape.innerHTML = `<label>${section.charAt(0).toUpperCase() + section.slice(1)}:</label>${newTextarea.outerHTML}<div class="shape-buttons"><button onclick="moveSection('${section}', 'up')" id="${section}-up">Move Up</button><button onclick="moveSection('${section}', 'down')" id="${section}-down">Move Down</button></div>`;
                                document.getElementById('sections').appendChild(newShape);
                            }
                        }
                    });

                    // Apply the saved template and order
                    sectionOrder = savedOrder;
                    document.getElementById('template').value = savedTemplate;
                    if (savedTemplate === 'Title-Content') {
                        document.getElementById('footer').value = ''; // Clear footer for Title-Content
                    }
                    updateSectionOrder();
                };
                reader.readAsText(file);
            } else {
                document.getElementById('status').textContent = 'No file selected.';
            }
        }

        // Initial setup
        updateSectionOrder();
    </script>
</body>
</html>
