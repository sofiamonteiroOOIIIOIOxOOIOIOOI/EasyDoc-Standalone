<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EasyDoc 2.0 - Shape-Based Editor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f0f0f0;
            max-width: 100%;
            box-sizing: border-box;
        }

        h1 {
            text-align: center;
            font-size: 1.5em;
        }

        .shape {
            background-color: #d3d3d3; /* Gray background for shapes */
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            width: 100%;
            box-sizing: border-box;
        }

        textarea {
            width: 100%;
            min-height: 80px;
            resize: vertical;
            border: none;
            background: transparent;
            font-size: 1em;
        }

        #preview-shape pre {
            margin: 0;
            white-space: pre-wrap;
            background-color: #e0e0e0; /* Lighter gray for preview */
            padding: 10px;
            border-radius: 5px;
        }

        button {
            padding: 10px 20px;
            margin: 5px 0;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            width: 100%;
            font-size: 1em;
        }

        button:hover {
            background-color: #45a049;
        }

        #status {
            color: #333;
            word-wrap: break-word;
        }

        /* Mobile Responsiveness */
        @media (max-width: 600px) {
            h1 {
                font-size: 1.2em;
            }
            .shape {
                padding: 5px;
                margin: 5px 0;
            }
            textarea {
                min-height: 60px;
                font-size: 0.9em;
            }
            button {
                padding: 8px;
                font-size: 0.9em;
            }
            select, input[type="text"] {
                width: 100%;
                padding: 5px;
                font-size: 0.9em;
                margin: 5px 0;
            }
        }
    </style>
</head>
<body>
    <h1>EasyDoc 2.0 - Build Your Document</h1>

    <label for="template">Select Template:</label>
    <select id="template" onchange="updatePreview()">
        <option value="Header-Content-Footer">Header-Content-Footer</option>
        <option value="Title-Content">Title-Content</option>
    </select>

    <div class="shape" id="header-shape">
        <label>Header/Title:</label>
        <textarea id="header">Sample Header\nEdit me!</textarea>
    </div>

    <div class="shape" id="content-shape">
        <label>Content:</label>
        <textarea id="content">This is the main content.\nWrite your document here.</textarea>
    </div>

    <div class="shape" id="footer-shape">
        <label>Footer:</label>
        <textarea id="footer">Footer - Add notes or credits.</textarea>
    </div>

    <button onclick="loadFile()">Load File into Content</button>
    <input type="file" id="fileInput" style="display:none;" accept=".txt" onchange="handleFileSelect(event)">

    <button onclick="updatePreview()">Refresh Preview</button>

    <div class="shape" id="preview-shape">
        <label>Preview:</label>
        <pre id="preview">Preview will appear here...</pre>
    </div>

    <label for="filename">Output Filename:</label>
    <input type="text" id="filename" value="output.pdf">

    <button onclick="generatePDF()">Generate PDF</button>
    <button onclick="saveContent()">Save Content</button>
    <p id="status"></p>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        function updatePreview() {
            const header = document.getElementById('header').value;
            const content = document.getElementById('content').value;
            const footer = document.getElementById('footer').value;
            const template = document.getElementById('template').value;

            let preview = '';
            if (template === "Header-Content-Footer") {
                preview = `Header:\n${header}\n\nContent:\n====\n${content}\n====\n\nFooter:\n${footer}`;
            } else if (template === "Title-Content") {
                preview = `Title: ${header}\n----\nContent:\n${content}`;
            }
            document.getElementById('preview').textContent = preview;
        }

        function generatePDF() {
            const header = document.getElementById('header').value;
            const content = document.getElementById('content').value;
            const footer = document.getElementById('footer').value;
            const template = document.getElementById('template').value;
            const filename = document.getElementById('filename').value || 'output.pdf';

            let pdfContent = '';
            if (template === "Header-Content-Footer") {
                pdfContent = `Header:\n${header}\n\nContent:\n====\n${content}\n====\n\nFooter:\n${footer}`;
            } else if (template === "Title-Content") {
                pdfContent = `Title: ${header}\n----\nContent:\n${content}`;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.text(pdfContent, 10, 10);
            doc.save(filename);

            document.getElementById('status').textContent = `PDF generated and downloaded as ${filename}`;
        }

        function saveContent() {
            const header = document.getElementById('header').value;
            const content = document.getElementById('content').value;
            const footer = document.getElementById('footer').value;
            // Use distinct section markers to avoid confusion
            const fullContent = `===SECTION:HEADER===\n${header}\n\n===SECTION:CONTENT===\n${content}\n\n===SECTION:FOOTER===\n${footer}`;
            const blob = new Blob([fullContent], { type: 'text/plain' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'easydoc_save.txt';
            link.click();
            document.getElementById('status').textContent = 'Content saved as easydoc_save.txt';
        }

        function loadFile() {
            document.getElementById('fileInput').click();
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const content = e.target.result;
                    // Parse the saved content using distinct section markers
                    const sections = content.split(/===SECTION:[A-Z]+===/);
                    let headerContent = '';
                    let mainContent = '';
                    let footerContent = '';

                    // Look for the section markers in the original content
                    if (content.includes('===SECTION:HEADER===')) {
                        const headerIndex = content.indexOf('===SECTION:HEADER===') + '===SECTION:HEADER==='.length;
                        const contentStart = content.indexOf('===SECTION:CONTENT===');
                        if (contentStart !== -1) {
                            headerContent = content.substring(headerIndex, contentStart).trim();
                        }
                    }
                    if (content.includes('===SECTION:CONTENT===')) {
                        const contentIndex = content.indexOf('===SECTION:CONTENT===') + '===SECTION:CONTENT==='.length;
                        const footerStart = content.indexOf('===SECTION:FOOTER===');
                        if (footerStart !== -1) {
                            mainContent = content.substring(contentIndex, footerStart).trim();
                        } else {
                            mainContent = content.substring(contentIndex).trim();
                        }
                    }
                    if (content.includes('===SECTION:FOOTER===')) {
                        const footerIndex = content.indexOf('===SECTION:FOOTER===') + '===SECTION:FOOTER==='.length;
                        footerContent = content.substring(footerIndex).trim();
                    }

                    // Assign parsed content to the respective textareas
                    document.getElementById('header').value = headerContent;
                    document.getElementById('content').value = mainContent;
                    document.getElementById('footer').value = footerContent;
                    updatePreview();
                };
                reader.readAsText(file);
            } else {
                document.getElementById('status').textContent = 'No file selected.';
            }
        }

        // Initial preview
        updatePreview();
    </script>
</body>
</html>
